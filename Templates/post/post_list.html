{% load static i18n %}

{% block content %}

<div class="feed">
    {% if user.is_authenticated %}
     <a href="{% url "new_post" %}">
        <button>{% trans 'Новый Пост' %}</button>
     </a>
     {% endif %}
    {% for post in posts %}
    
    <article class="post card-animate">
        <div class="post-header">
            <div class="post-avatar">
                <div class="avatar-circle">
                    {{ post.author.username|first|upper }}
                </div>
            </div>
            <div class="post-user-info">
                <div class="username">
                    {{ post.author.username }}
                </div>
                <div class="timestamp">
                    {{ post.time_stamp|date:"d M Y H:i" }}
                    {% if post.edited %}
                        <span class="edited-badge">{% trans 'edited' %}</span>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- IMAGE -->
        {% if post.att %}
        <div class="post_img">
            <img src="{{ post.att.0.file.url }}" alt="post image">
        </div>
        {% endif %}

        <!-- TEXT CONTENT -->
        <div class="post_content">
            <a href="{% url  'post_details' pid=post.pk %}">
                <h1 class="post-title">{{ post.title }}</h1>
            </a>
            <p class="post-text">{{ post.content }}</p>
        </div>
        {% if user.is_authenticated and user == post.author or user.is_staff or user.is_superuser %}
        <a href="{% url "edit_post" pid=post.pk %}">
            <button>{% trans 'Изменить Пост' %}</button>
        </a>

         <a href="{% url "delete_post" pid=post.pk %}">
            <button>{% trans 'Удалить Пост' %}</button>
        </a>
        {% endif %}
        
        <div>
        {% if user.is_authenticated %}
        <form method="post" action="{% url 'post_list' %}">
            {% csrf_token %}
            <input type="hidden" name="action" value="likes">
            <input type="hidden" name="post_id" value="{{post.pk}}">

            <button type="submit">
                {% if user in post.likes.all %}
                    ♥︎ {{post.likes.count}}
                {% else %}
                    ♡ {{post.likes.count}}
                {% endif %}
            </button>
        </form>
         {% endif %}
        </div>


        <!-- COMMENTS SECTION (layout) -->
         {% if user.is_authenticated %}
        <form method="post" action="{% url 'post_list' %}" class="add-comment">
            {% csrf_token %}
            <input type="hidden" name="action" value="comment">
            <input type="hidden" name="post_id" value="{{post.pk}}">
            <textarea name="content" placeholder="{% trans "Ваш Комментарий..." %}"%></textarea>
            <button type="submit">{% trans 'Опубликовать' %}</button>
        </form>
        {% endif %}
        <div class="post-comments">
            {% if post.comments_pin %}
                {% for comment in post.comments_pin %}
                    <div style="border-top: 1px gray solid">
                        <p>{{comment.author.username}} {{comment.time_stamp}} ({% trans 'Закреплено' %})</p>
                        <h3>{{comment.content}}</h3>
                    </div>
                {% endfor %}
            {% endif %}
            {% for comment in post.comments_reg %}
                    <div style="border-top: 1px gray solid">
                        <p>{{comment.author.username}} {{comment.time_stamp}}</p>
                        <h3>{{comment.content}}</h3>
                    </div>
                {% endfor %}
        </div>
    </article>
    
    {% endfor %}
</div>

{% endblock %}
